# 55 杠杆交易和期货

## 杠杆交易

用数倍于自有资金来买入和卖出资产

- 做多（long）
- 做空（short）

既然拿的是数倍于自己的资金，那么就相当于是借，如果做多的时候，资产价格上涨，就会得到数倍于现货交易的收益，但如果下跌，则会损失数倍于现货交易的亏损，为了让合约交易所免受于亏钱，有一套清算机制

#### 清算模拟

- A自己持有2000块，目前eth刚好2000块一颗
- A向B缴纳保证金2000块，要求用5x杠杆来购买5颗eth
- 此时保证金率 = 2000/(2000 * 5) = 20%
- 此时eth资产下跌100块到1900，保证金率 = (1900 - 5*100)/(1900 * 5) = 14.7%
- 如果继续下跌，保证金率继续下跌，如果跌到5%就会触发清算

#### 相关术语

- 杠杆倍数：leverage

- 保证金：Margin

- 持仓仓位、头寸（杠杆后持有多少颗？）：Position

- 仓位价值/名义价值（正为多，负为空）：头寸 * 价格

- 盈亏：PNL（profit and loss）：仓位价值-开仓价值（做空时*-1）

- 保证金率：Margin Ratio

  $\text{保证金率} = \frac{\text{账户净值}}{\text{持仓价值}} = \frac{\text{初始保证金} + \text{未实现盈亏}}{\text{持仓价值}}$

- 维持保证金率：保证金率降低到维持保证金率就触发清算

### 维持保证金率（binance为例）

> 因为大多数人其实都是小金额玩（保证金< 1wU），大概可以记作维持0.4% ～ 0.65%，资金量越高，其实提供的可玩杠杆偏低，以及清算的保证金率比较高，都是为了保护交易所，怕清算的时候不能清算干净

| 层级 | 持仓 (USDT名义价值)       | 最高杠杆倍数 | 维持保证金比率 | 维持保证金速算额 (USDT) |
| ---- | ------------------------- | ------------ | -------------- | ----------------------- |
| 1    | 0 - 50,000                | 125x         | 0.40%          | 0                       |
| 2    | 50,000 - 600,000          | 100x         | 0.50%          | 50                      |
| 3    | 600,000 - 3,000,000       | 75x          | 0.65%          | 950                     |
| 4    | 3,000,000 - 12,000,000    | 50x          | 1.00%          | 11,450                  |
| 5    | 12,000,000 - 70,000,000   | 25x          | 2.00%          | 131,450                 |
| 6    | 70,000,000 - 100,000,000  | 20x          | 2.50%          | 481,450                 |
| 7    | 100,000,000 - 230,000,000 | 10x          | 5.00%          | 2,981,450               |
| 8    | 230,000,000 - 480,000,000 | 5x           | 10.00%         | 14,481,450              |

## Perpetual Protocal

- vAmm（Virtual Auto Market Maker）：提供虚拟流动性
- 没有真实的资金池：杠杆借的其实是虚拟的数字币，获取的虚拟头寸（比如你用1颗的价值的保证金x5买了5颗，实际上这5颗的价值都是虚拟头寸）
- 多空双方互为对手
- 通过预言机chainlink为佳，结算资金费保持价格不偏离
- 遵循恒定K的原则，开单和结单的时候其实相当于一次swap



